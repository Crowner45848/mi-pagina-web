<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito de Productos</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Carrito de Productos</h1>

    <!-- Formulario para agregar productos -->
    <div class="producto">
      <h2>Agregar Producto</h2>
      <label for="mesa">Mesa:</label>
      <select id="mesa" required>
        <option value="Mesa 1">Mesa 1</option>
        <option value="Mesa 2">Mesa 2</option>
        <option value="Mesa 3">Mesa 3</option>
        <option value="Mesa 4">Mesa 4</option>
      </select>
      
      <label for="producto">Producto:</label>
      <select id="producto" required>
        <option value="Vodka">Vodka</option>
        <option value="Cerveza">Cerveza</option>
        <option value="Refresco">Refresco</option>
        <option value="Agua">Agua</option>
      </select>

      <label for="cantidad">Cantidad:</label>
      <input type="number" id="cantidad" placeholder="2" required>

      <label for="estado">Estado:</label>
      <select id="estado">
        <option value="Pendiente">Pendiente</option>
        <option value="Entregado">Entregado</option>
      </select>

      <button onclick="agregarProducto()">Agregar al Carrito</button>
    </div>

    <!-- Resumen del carrito -->
    <div class="carrito">
      <h2>Resumen del Carrito</h2>
      <table id="tablaCarrito">
        <thead>
          <tr>
            <th>Mesa</th>
            <th>Producto</th>
            <th>Cantidad</th>
            <th>Estado</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody>
          <!-- Aquí se agregarán los productos dinámicamente -->
        </tbody>
      </table>
      <br>
      <button onclick="enviarPedido()">Enviar Pedido</button>
    </div>

    <!-- Resultado del envío -->
    <div id="resultado"></div>
  </div>

  <script>
    let carrito = [];

    // Función para agregar un producto al carrito
    function agregarProducto() {
      const mesa = document.getElementById('mesa').value;
      const producto = document.getElementById('producto').value;
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const estado = document.getElementById('estado').value;

      if (mesa && producto && cantidad && estado) {
        const nuevoProducto = { mesa, producto, cantidad, estado };
        carrito.push(nuevoProducto);
        actualizarCarrito();
      } else {
        alert("Por favor, completa todos los campos.");
      }
    }

    // Función para actualizar la tabla del carrito
    function actualizarCarrito() {
      const tbody = document.querySelector('#tablaCarrito tbody');
      tbody.innerHTML = '';

      carrito.forEach((producto, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${producto.mesa}</td>
          <td>${producto.producto}</td>
          <td>${producto.cantidad}</td>
          <td>${producto.estado}</td>
          <td><button onclick="eliminarProducto(${index})">Eliminar</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    // Función para eliminar un producto del carrito
    function eliminarProducto(index) {
      carrito.splice(index, 1);
      actualizarCarrito();
    }

    // Función para enviar el pedido al script de Google Apps Script
    function enviarPedido() {
      if (carrito.length === 0) {
        alert("El carrito está vacío.");
        return;
      }

      const url = "https://script.google.com/macros/s/AKfycbzj4LgjNBq3UOFuYZS2d9ZFoFN8HdgAq0Xy8XblKpIDbtlLq02QFthmY0_YPE-KDzY/exec?accion=anadir";
      const valores = JSON.stringify(carrito);

      fetch(`${url}&valores=${encodeURIComponent(valores)}`, {
        method: 'GET',
      })
        .then(response => {
          if (!response.ok) {
            throw new Error(`Error HTTP: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          document.getElementById('resultado').innerHTML = `
            <h2>Respuesta del Servidor</h2>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
          carrito = [];
          actualizarCarrito();
        })
        .catch(error => {
          document.getElementById('resultado').innerHTML = `
            <h2>Error</h2>
            <p>${error.message}</p>
          `;
        });
    }
  </script>
</body>
</html>
